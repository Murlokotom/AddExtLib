
░█████╗░██████╗░██████╗░███████╗██╗░░██╗████████╗██╗░░░░░██╗██████╗░
██╔══██╗██╔══██╗██╔══██╗██╔════╝╚██╗██╔╝╚══██╔══╝██║░░░░░██║██╔══██╗
███████║██║░░██║██║░░██║█████╗░░░╚███╔╝░░░░██║░░░██║░░░░░██║██████╦╝
██╔══██║██║░░██║██║░░██║██╔══╝░░░██╔██╗░░░░██║░░░██║░░░░░██║██╔══██╗
██║░░██║██████╔╝██████╔╝███████╗██╔╝╚██╗░░░██║░░░███████╗██║██████╦╝
╚═╝░░╚═╝╚═════╝░╚═════╝░╚══════╝╚═╝░░╚═╝░░░╚═╝░░░╚══════╝╚═╝╚═════╝░


# Макрос `AddExtLib` для CMake

Макрос `AddExtLib` предназначен для упрощения добавления внешних библиотек в CMake-проекты. Он автоматизирует процесс загрузки, сборки и установки внешних зависимостей, а также обеспечивает их интеграцию в ваш проект.

## Основные возможности

- Автоматическая загрузка исходных кодов из Git-репозиториев.
- Поддержка указания тегов, веток или хэшей коммитов.
- Автоматическая сборка и установка библиотек с использованием CMake.
- Поддержка настройки параметров сборки через CMake-флаги.
- Проверка изменений в конфигурации и автоматическая пересборка при необходимости.
- Копирование скомпилированных библиотек и исполняемых файлов в целевые директории.
- Упорядоченная структура проекта

## Использование

### Основной синтаксис

```cmake
AddExtLib(
    [SILENT]
    [NAME <имя_библиотеки>]
    [REPO <URL_репозитория>]
    [TAG <тег_или_ветка>]
    [OPTIONS <флаги_CMake>]
    [DEPENDS <зависимости>]
)
```
или
```cmake
AddExtLib(
    <URL_репозитория>
    [SILENT]
    [NAME <имя_библиотеки>]
    [TAG <тег_или_ветка>]
    [OPTIONS <флаги_CMake>]
    [DEPENDS <зависимости>]
)
```

### Параметры

- **SILENT**: Если указан, то вывод информации о библиотеке будет сокращен.
- **NAME**: Имя библиотеки. Если не указано, будет извлечено из URL Git-репозитория.
- **REPO**: URL Git-репозитория. Поддерживаются сокращенные форматы:
  - `gh:` для GitHub (например, `gh:user/repo`).
  - `gl:` для GitLab (например, `gl:user/repo`).
  - `bb:` для Bitbucket (например, `bb:user/repo`).
  - Полный URL (например, `https://github.com/user/repo.git`).
- **TAG**: Тег, ветка или хэш коммита. Если не указан, будет использован последний найденный тег. Если тэг не найден, то будет попытка найти максимально похожий тэг. Также возможно прописать тэг после URL Git-репозитория через "@" (например `gh:user/repo@1.0.0` или `https://github.com/user/repo.git@1.0.0`)
- **OPTIONS**: Список флагов CMake для настройки сборки (например, `BUILD_TEST=OFF`). Если не указан переключатель ON или OFF после значения флага, то предполагается, что значения флага "ON". Вместо "=" можно использовать пробел.
- **DEPENDS**: Список зависимостей, которые должны быть собраны перед этой библиотекой.

### Примеры использования

#### Простой пример

```cmake
AddExtLib(
    REPO "https://github.com/DCMTK/dcmtk.git"
    TAG "DCMTK-3.6.7"
    OPTIONS "BUILD_SHARED_LIBS=ON" "BUILD_TESTING=OFF"
)
```

#### Использование сокращенного URL

```cmake
AddExtLib(
    "gh:google/googletest@1.21.1"
    OPTIONS "BUILD_GMOCK=ON"
)
```

#### Указание зависимостей

```cmake
AddExtLib(
    NAME "MyLibrary"
    REPO "https://github.com/user/mylibrary.git"
    TAG "v1.0.0"
    OPTIONS "BUILD_SHARED_LIBS=ON"
    DEPENDS "SomeOtherLibrary"
)
```
## Процедура компиляции проекта, использующего макрос `AddExtLib` для CMake
При первом проходе конфигурации и компиляции cmake сначала скачиваются и компилируются библиотеки. При втором и последующих проходах уже скачанные и откомпилированные библиотеки подключаются к основной программе. При изменении параметра **OPTIONS** запускается процедура принудительной перекомпиляции библиотеки. Для контроля того, какой этап происходит определяется переменная ALL_EXTLIB_ADDED, которая показывает, что все внешние библиотеки готовы к подключению к основному проекту.
Пример кода CMakeList.txt:
```cmake
cmake_minimum_required(VERSION 3.14)
project(ael_test)
set(CMAKE_CXX_STANDARD 17)
include(cmake/AddExtLibs.cmake)
AddExtLib("gh:fmtlib/fmt.git@11.1.3" OPTIONS "BUILD_SHARED_LIBS" "FMT_TEST=OFF" SILENT)

if(ALL_EXTLIB_ADDED)
	file(GLOB_RECURSE MAIN_SOURCE_FILES ${PROJECT_SOURCE_DIR}/src/*.cpp)
	list(APPEND ALL_SOURCES ${MAIN_SOURCE_FILES})
	add_executable(ael_test ${ALL_SOURCES})
	target_include_directories(ael_test PRIVATE "${PROJECT_SOURCE_DIR}/src/")
	target_link_libraries(ael_test fmt::fmt)
	set_target_properties(ael_test  PROPERTIES  RUNTIME_OUTPUT_DIRECTORY  ${PROJECT_BINARY_DIR})
endif()
```
## Дополнительные команды

Макрос `AddExtLib` также создает несколько дополнительных целей для управления исходными кодами и установленными файлами:

- **`<имя_библиотеки>_clear_sources`**: Очищает директорию со скачанными исходными кодами библиотеки.
- **`<имя_библиотеки>_clear_install`**: Очищает директорию с установленными файлами библиотеки.
- **`<имя_библиотеки>_clear_all`**: Очищает обе директории (исходные коды и установленные файлы).

## Настройка путей

Макрос использует следующие переменные для настройки путей:

- **`AEL_EXEC_DIR`**: Директория для исполняемых файлов (по умолчанию `exec`).
- **`AEL_BUILD_DIR`**: Директория для сборки (по умолчанию `build`).
- **`AEL_EXTERNAL_DIR`**: Директория для исходных кодов внешних библиотек (по умолчанию `external`).
- **`AEL_INSTALL_DIR`**: Директория для установки внешних библиотек (по умолчанию `install`).

Эти переменные могут быть переопределены перед включением макроса.

## Примечания

- Макрос использует `ExternalProject_Add` для загрузки и сборки библиотек.
- Для работы макроса требуется установленный Git и CMake.

## Лицензия

Этот макрос распространяется под лицензией MIT. Используйте его на свой страх и риск.

[Link to create a logo](https://fsymbols.com/ru/generatory/)